terraform/day_0
cat user-registry.json | docker login   --username json_key   --password-stdin   cr.yandex 
kubectl create secret generic regcred     --from-file=.dockerconfigjson=$HOME/.docker/config.json   --type=kubernetes.io/dockerconfigjson -n kube-system
kubectl create secret -n kube-system generic webapp --from-literal access_key=$(cat user-web.json |  jq '.access_key') --from-literal secret_key=$(cat user-web.json |  jq '.secret_key')
sudo cat /etc/gitlab/initial_root_password
terraform destroy -target=module.vpc -target=module.ci_cd -target=module.backend -target=module.web-app -target=module.registry -auto-approve

k8s
helm install --namespace metallb-system metallb metallb/metallb --create-namespace
helm install gitlab-runner -f gitlab/values.yml ./gitlab/gitlab-runner-0.51.0.tgz
helm install nginx-ingress nginx-stable/nginx-ingress --set rbac.create=true --namespace ingress-nginx --create-namespace



web-app
git remote add gitlab http://158.160.44.245/gitlab-instance-93491fdd/diplom.git

gre

ssh -i ssh/id_rsa -o ProxyCommand="ssh -i ssh/id_rsa -o StrictHostKeyChecking=no -W %h:%p 158.160.50.131" 10.1.1.254

########worker 1
modprobe ip_gre
lsmod | grep gre

echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf
sysctl -p
ip tunnel add gre1 mode gre local 10.0.2.17 remote  192.168.2.254 ttl 255
ip addr add 10.10.10.2/30 dev gre1
ip link set gre1 up

ip addr add 10.0.2.253 dev lo
ip route add 192.168.2.253 dev gre1

##########worker 2
modprobe ip_gre
lsmod | grep gre

sudo echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf
sysctl -p
ip tunnel add gre1 mode gre local 10.0.1.3 remote  192.168.2.254 ttl 255
ip addr add 10.10.10.4/30 dev gre1
ip link set gre1 up

ip addr add 10.0.1.253 dev lo
ip route add 192.168.2.253 dev gre1



###########nat
ip addr add 192.168.2.253 dev lo
###to worker 2
ip tunnel add gre1 mode gre local 192.168.2.254 remote   10.0.2.17  ttl 255
ip addr add 10.10.10.1/30 dev gre1
ip link set gre1 up

ip route add 10.0.2.253 dev gre1 

###to worker 1
ip tunnel add gre2 mode gre local 192.168.2.254 remote   10.0.1.3  ttl 255
ip addr add 10.10.10.5/30 dev gre2
ip link set gre2 up

ip route add 10.0.1.253 dev gre2

